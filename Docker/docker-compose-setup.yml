services:
  clypse-setup:
    build:
      context: ..
      dockerfile: clypse.portal.setup/Dockerfile
    container_name: clypse-setup
    depends_on:
      localstack:
        condition: service_healthy
    environment:
      - AWS_EC2_METADATA_DISABLED=true
      - CLYPSE_SETUP__BaseUrl=http://localstack:4566
      - CLYPSE_SETUP__AccessId=test
      - CLYPSE_SETUP__SecretAccessKey=test
      - CLYPSE_SETUP__Region=us-east-1
      - CLYPSE_SETUP__InteractiveMode=false
      - CLYPSE_SETUP__ResourcePrefix=testing
      - CLYPSE_SETUP__InitialUserEmail=foo@bar.com
    restart: "no"

volumes:
  localstack-data: